<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- ğŸ“± ëª¨ë°”ì¼ ì›¹ ì•± ì„¤ì • (ì•±ì²˜ëŸ¼ ë³´ì´ê²Œ í•˜ëŠ” í•µì‹¬ ì½”ë“œ) -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#ffffff">
    <title>ì²­ë‘ & ì‹œì•ˆ ì—¬í–‰</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8f9fa;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 100px;
            /* ì•„ì´í° ë…¸ì¹˜ ëŒ€ì‘ */
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .timeline-container { position: relative; }
        .timeline-line {
            position: absolute;
            left: 28px;
            top: 20px;
            bottom: 0;
            width: 2px;
            background-color: #e5e7eb;
            z-index: 0;
        }
        
        .btn-press:active { transform: scale(0.98); }
        .heart-anim { transition: all 0.2s ease; }
        .heart-anim:active { transform: scale(1.3); }
        
        .active-tab { border-bottom: 2px solid #ef4444; color: #ef4444; font-weight: 700; }
        .inactive-tab { color: #9ca3af; }

        .edit-mode-shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 max-w-md mx-auto shadow-2xl min-h-screen relative select-none">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-40">
        <div class="px-4 py-3 flex justify-between items-center bg-white border-b border-gray-100">
            <div>
                <h1 class="text-xl font-bold text-gray-900 tracking-tight">ì²­ë‘ & ì‹œì•ˆ ì—¬í–‰</h1>
                <p class="text-xs text-gray-500 flex items-center gap-1">
                    <span id="totalDays">6ë°• 7ì¼</span>
                    <span id="saveStatus" class="text-green-500 hidden"><i class="fa-solid fa-check"></i> ì €ì¥ë¨</span>
                </p>
            </div>
            <div class="flex gap-2">
                <button onclick="toggleEditMode()" id="btnEditMode" class="w-10 h-10 rounded-full bg-gray-100 text-gray-600 flex items-center justify-center transition hover:bg-gray-200">
                    <i class="fa-solid fa-pen"></i>
                </button>
                <button onclick="confirmReset()" class="w-10 h-10 rounded-full bg-gray-100 text-gray-600 flex items-center justify-center transition hover:bg-gray-200">
                    <i class="fa-solid fa-rotate-right"></i>
                </button>
            </div>
        </div>
        
        <!-- View Tabs -->
        <div class="flex border-b border-gray-200 bg-white">
            <button onclick="viewMode='list'; render();" class="flex-1 py-3 text-sm font-medium text-center text-red-500 border-b-2 border-red-500 transition" id="tabList">
                ì¼ì • ëª©ë¡
            </button>
            <button onclick="viewMode='likes'; render();" class="flex-1 py-3 text-sm font-medium text-center text-gray-400 hover:text-gray-600 transition" id="tabLikes">
                ì €ì¥ëœ ì¥ì†Œ (<span id="likeCount">0</span>)
            </button>
        </div>

        <!-- Date Navigation -->
        <div id="dateNavWrapper" class="overflow-x-auto hide-scrollbar bg-white shadow-sm">
            <div class="flex px-2 min-w-max" id="dateNav">
                <!-- JS Generated -->
            </div>
        </div>
    </header>

    <!-- Install Guide Banner (Shows only once) -->
    <div id="installBanner" class="hidden bg-gradient-to-r from-blue-500 to-blue-600 text-white p-3 text-sm flex justify-between items-center shadow-md">
        <div class="flex gap-2 items-center">
            <i class="fa-solid fa-mobile-screen"></i>
            <span>ë¸Œë¼ìš°ì € ë©”ë‰´ì—ì„œ <b>'í™ˆ í™”ë©´ì— ì¶”ê°€'</b>ë¥¼ ëˆ„ë¥´ë©´ ì•±ì²˜ëŸ¼ ì“¸ ìˆ˜ ìˆì–´ìš”!</span>
        </div>
        <button onclick="closeBanner()" class="text-white/80 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
    </div>

    <!-- Main Content -->
    <main id="schedule-container" class="p-4 min-h-[60vh]">
        <!-- JS Generated -->
    </main>

    <!-- Floating Add Button -->
    <div id="fabAdd" class="fixed bottom-24 right-6 z-30 hidden">
        <button onclick="openEditModal(null)" class="bg-blue-600 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center hover:bg-blue-700 transition transform active:scale-90">
            <i class="fa-solid fa-plus text-2xl"></i>
        </button>
    </div>

    <!-- Map Choice Modal -->
    <div id="mapModal" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center px-6 backdrop-blur-sm">
        <div class="bg-white rounded-2xl w-full max-w-sm p-6 animate-fade-in shadow-2xl">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h3 class="text-lg font-bold text-gray-900" id="modalTitle">ì¥ì†Œ ì´ë¦„</h3>
                    <p class="text-sm text-gray-500" id="modalChnName">ì¤‘êµ­ì–´ ì´ë¦„</p>
                </div>
                <button onclick="closeMapModal()" class="text-gray-400 hover:text-gray-600"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="grid grid-cols-2 gap-3">
                <a id="btnGaode" href="#" target="_blank" class="flex flex-col items-center justify-center p-4 rounded-xl bg-blue-50 text-blue-700 border border-blue-100">
                    <i class="fa-solid fa-location-dot text-2xl mb-2"></i>
                    <span class="font-bold text-sm">ê³ ë•ì§€ë„ (Amap)</span>
                </a>
                <a id="btnBaidu" href="#" target="_blank" class="flex flex-col items-center justify-center p-4 rounded-xl bg-red-50 text-red-700 border border-red-100">
                    <i class="fa-solid fa-paw text-2xl mb-2"></i>
                    <span class="font-bold text-sm">ë°”ì´ë‘ë§µ (Baidu)</span>
                </a>
            </div>
             <button onclick="copyChnName()" class="w-full mt-3 py-3 text-sm text-gray-600 bg-gray-100 rounded-lg font-medium">
                <i class="fa-regular fa-copy mr-1"></i> ì¤‘êµ­ì–´ ì§€ëª… ë³µì‚¬
            </button>
        </div>
    </div>

    <!-- Edit/Add Item Modal -->
    <div id="editModal" class="fixed inset-0 bg-black/60 z-[60] hidden flex items-end sm:items-center justify-center sm:px-4">
        <div class="bg-white w-full max-w-md rounded-t-2xl sm:rounded-2xl p-6 animate-slide-up sm:animate-fade-in h-[85vh] sm:h-auto overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold" id="editModalTitle">ì¼ì • ì¶”ê°€</h3>
                <button onclick="closeEditModal()" class="text-gray-400"><i class="fa-solid fa-xmark text-2xl"></i></button>
            </div>
            
            <form id="editForm" onsubmit="saveItem(event)" class="space-y-4">
                <input type="hidden" id="editItemId">
                
                <div class="grid grid-cols-3 gap-4">
                    <div class="col-span-1">
                        <label class="block text-xs font-bold text-gray-500 mb-1">ì‹œê°„</label>
                        <input type="text" id="editTime" placeholder="10:00" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 outline-none" required>
                    </div>
                    <div class="col-span-2">
                         <label class="block text-xs font-bold text-gray-500 mb-1">ì•„ì´ì½˜</label>
                         <select id="editIcon" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3">
                             <option value="fa-location-dot">ğŸ“ ì¥ì†Œ</option>
                             <option value="fa-utensils">ğŸ´ ì‹ì‚¬</option>
                             <option value="fa-hotel">ğŸ¨ ìˆ™ì†Œ</option>
                             <option value="fa-plane">âœˆï¸ ë¹„í–‰ê¸°</option>
                             <option value="fa-train">ğŸš„ ê¸°ì°¨</option>
                             <option value="fa-camera">ğŸ“· ê´€ê´‘</option>
                             <option value="fa-bag-shopping">ğŸ›ï¸ ì‡¼í•‘</option>
                         </select>
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-gray-500 mb-1">ì¥ì†Œëª… (í•œê¸€)</label>
                    <input type="text" id="editTitle" placeholder="ì˜ˆ: ë³‘ë§ˆìš©" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 outline-none" required>
                </div>

                <div>
                    <label class="block text-xs font-bold text-gray-500 mb-1">ì¥ì†Œëª… (ì¤‘êµ­ì–´) <span class="font-normal text-red-400">*ì§€ë„ ê²€ìƒ‰ìš©</span></label>
                    <input type="text" id="editChnName" placeholder="ì˜ˆ: å…µé©¬ä¿‘" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 outline-none">
                </div>

                <div>
                    <label class="block text-xs font-bold text-gray-500 mb-1">ì„¤ëª… / ë©”ëª¨</label>
                    <textarea id="editDesc" rows="3" placeholder="ê°„ë‹¨í•œ ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 outline-none"></textarea>
                </div>

                <details class="text-xs text-gray-500">
                    <summary class="cursor-pointer mb-2">ì¢Œí‘œ ì§ì ‘ ì…ë ¥ (ì„ íƒì‚¬í•­)</summary>
                    <div class="grid grid-cols-2 gap-3">
                        <input type="number" step="any" id="editLat" placeholder="ìœ„ë„(Lat)" class="bg-gray-50 border border-gray-200 rounded p-2">
                        <input type="number" step="any" id="editLng" placeholder="ê²½ë„(Lng)" class="bg-gray-50 border border-gray-200 rounded p-2">
                    </div>
                </details>

                <button type="submit" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:bg-blue-700 transition mt-4">
                    ì €ì¥í•˜ê¸°
                </button>
                
                <button type="button" onclick="deleteCurrentItem()" id="btnDelete" class="w-full text-red-500 py-3 font-medium text-sm hidden">
                    ì´ ì¼ì • ì‚­ì œí•˜ê¸°
                </button>
            </form>
        </div>
    </div>

    <!-- Scroll Top -->
    <div class="fixed bottom-6 right-6 z-20">
        <button onclick="window.scrollTo({top:0, behavior:'smooth'})" class="bg-white text-gray-800 w-10 h-10 rounded-full shadow border border-gray-200 flex items-center justify-center">
            <i class="fa-solid fa-arrow-up"></i>
        </button>
    </div>

    <script>
        // --- Initial Data ---
        const initialScheduleData = [
            {
                day: 1, date: "12.30 (í™”)", city: "ì²­ë‘", title: "ì¶œêµ­ ë° ì´ë™",
                items: [
                    { id: 101, time: "12:00", title: "ì‹œì•ˆ ì…´ì–‘ êµ­ì œê³µí•­", chnName: "è¥¿å®‰å’¸é˜³å›½é™…æœºåœº", lat: 34.447, lng: 108.751, desc: "ë„ì°© í›„ ë°”ë¡œ ì‹œì•ˆë¶ì—­ìœ¼ë¡œ ì´ë™", icon: "fa-plane-arrival" },
                    { id: 102, time: "13:30", title: "ì‹œì•ˆë¶ì—­ (ê³ ì†ì² ë„)", chnName: "è¥¿å®‰åŒ—ç«™", lat: 34.376, lng: 108.939, desc: "Gì—´ì°¨ íƒ‘ìŠ¹ (ì‹œì•ˆâ†’ì²­ë‘ ì•½ 4ì‹œê°„)", icon: "fa-train" },
                    { id: 103, time: "19:30", title: "ì²­ë‘ ì¶˜ì‹œë£¨ (ìˆ™ì†Œ)", chnName: "æ˜¥ç†™è·¯", lat: 30.655, lng: 104.081, desc: "í˜¸í…” ì²´í¬ì¸ ë° ì‹œë‚´ ì¤‘ì‹¬ê°€ ì‚°ì±…", icon: "fa-hotel" },
                    { id: 104, time: "20:30", title: "í•˜ì´ë””ë¼ì˜¤ í› ê¶ˆ", chnName: "æµ·åº•æç«é”…", lat: 30.656, lng: 104.082, desc: "ì“°ì´¨ ì •í†µ í› ê¶ˆ ì²´í—˜ (ëŒ€ê¸° í™•ì¸ í•„ìˆ˜)", icon: "fa-bowl-food" }
                ]
            },
            {
                day: 2, date: "12.31 (ìˆ˜)", city: "ì²­ë‘", title: "íŒë‹¤ & ì¹´ìš´íŠ¸ë‹¤ìš´",
                items: [
                    { id: 201, time: "08:30", title: "ì²­ë‘ íŒë‹¤ ê¸°ì§€", chnName: "æˆéƒ½å¤§ç†ŠçŒ«ç¹è‚²ç ”ç©¶åŸºåœ°", lat: 30.733, lng: 104.146, desc: "ì˜¤ì „ ì¼ì° ë°©ë¬¸í•´ì•¼ í™œë°œí•œ íŒë‹¤ ê´€ëŒ ê°€ëŠ¥", icon: "fa-paw" },
                    { id: 202, time: "14:30", title: "ë¬´í›„ì‚¬ & ê¸ˆë¦¬ ê±°ë¦¬", chnName: "æ­¦ä¾¯ç¥  / é”¦é‡Œå¤è¡—", lat: 30.646, lng: 104.049, desc: "ì‚¼êµ­ì§€ì˜ ì—­ì‚¬ì™€ ì „í†µ ê±°ë¦¬ ì‚°ì±…", icon: "fa-landmark" },
                    { id: 203, time: "19:00", title: "IFS ëª° & íƒ€ì´ì¿ ë¦¬", chnName: "æˆéƒ½IFS / è¿œæ´‹å¤ªå¤é‡Œ", lat: 30.655, lng: 104.081, desc: "ê±´ë¬¼ì— ë§¤ë‹¬ë¦° íŒë‹¤ ì¡°í˜•ë¬¼ê³¼ ì‡¼í•‘", icon: "fa-bag-shopping" },
                    { id: 204, time: "23:50", title: "ê¸ˆìœµì„¼í„° ìŒë‘¥ì´ë¹Œë”©", chnName: "å¤©åºœå›½é™…é‡‘èä¸­å¿ƒ", lat: 30.572, lng: 104.066, desc: "ìƒˆí•´ë§ì´ ì¡°ëª…ì‡¼ ë° ì¹´ìš´íŠ¸ë‹¤ìš´ ëª…ì†Œ", icon: "fa-champagne-glasses", isHighlight: true }
                ]
            },
            {
                day: 3, date: "01.01 (ëª©)", city: "ì²­ë‘", title: "ì—¬ìœ ì™€ íë§",
                items: [
                    { id: 301, time: "10:00", title: "ì¸ë¯¼ê³µì› (í—ˆë°ì°»ì§‘)", chnName: "äººæ°‘å…¬å›­ (é¹¤é¸£èŒ¶ç¤¾)", lat: 30.660, lng: 104.056, desc: "ì°¨ í•œì”ê³¼ ê·€ì²­ì†Œ ì²´í—˜", icon: "fa-mug-hot" },
                    { id: 302, time: "12:30", title: "ì½´ìì´ìƒ¹ì¦ˆ", chnName: "å®½çª„å··å­", lat: 30.663, lng: 104.053, desc: "ì²­ë‚˜ë¼ ì‹œëŒ€ì˜ ê³¨ëª©ê¸¸ ë³´ì¡´ ì§€êµ¬", icon: "fa-road" },
                    { id: 303, time: "15:00", title: "ë³€ê²€ ê³µì—° (ìˆ˜ìœ ì°¨ê´€)", chnName: "èœ€é£é›…éŸµä¿¡ä¹‰åŠ", lat: 30.664, lng: 104.045, desc: "ì“°ì´¨ ì „í†µ ê°€ë©´ê·¹ ê´€ëŒ (ì˜ˆì•½ í•„ìˆ˜)", icon: "fa-masks-theater" }
                ]
            },
            {
                day: 4, date: "01.02 (ê¸ˆ)", city: "ì‹œì•ˆ", title: "ì‹œì•ˆ ì´ë™ & ì•¼ê²½",
                items: [
                    { id: 401, time: "09:00", title: "ì²­ë‘ë™ì—­", chnName: "æˆéƒ½ä¸œç«™", lat: 30.629, lng: 104.141, desc: "ê³ ì†ì—´ì°¨ íƒ‘ìŠ¹ (ì²­ë‘â†’ì‹œì•ˆ)", icon: "fa-train" },
                    { id: 402, time: "15:00", title: "ì‹œì•ˆ ì¢…ë£¨ & ê³ ë£¨", chnName: "è¥¿å®‰é’Ÿæ¥¼ / é¼“æ¥¼", lat: 34.260, lng: 108.947, desc: "ì‹œì•ˆì˜ ëœë“œë§ˆí¬ ì¤‘ì‹¬ì§€", icon: "fa-bell" },
                    { id: 403, time: "17:00", title: "íšŒì¡± ê±°ë¦¬", chnName: "å›æ°‘è¡—", lat: 34.264, lng: 108.943, desc: "ì´êµ­ì ì¸ ë¨¹ê±°ë¦¬ ì•¼ì‹œì¥ (ë±¡ë±¡ë©´ ì¶”ì²œ)", icon: "fa-utensils" }
                ]
            },
            {
                day: 5, date: "01.03 (í† )", city: "ì‹œì•ˆ", title: "ë³‘ë§ˆìš© & ì¥í•œê°€",
                items: [
                    { id: 501, time: "10:00", title: "ë³‘ë§ˆìš©ê°±", chnName: "ç§¦å§‹çš‡å…µé©¬ä¿‘åšç‰©é¦†", lat: 34.385, lng: 109.278, desc: "ì§„ì‹œí™©ì˜ ì§€í•˜ êµ°ë‹¨ (1í˜¸ê°± í•„ìˆ˜)", icon: "fa-person-military-pointing", isHighlight: true },
                    { id: 502, time: "14:00", title: "í™”ì²­ì§€", chnName: "åæ¸…å®«", lat: 34.365, lng: 109.213, desc: "ì–‘ê·€ë¹„ì™€ ë‹¹í˜„ì¢…ì˜ ì˜¨ì²œ ê¶ì „", icon: "fa-mountain" },
                    { id: 503, time: "18:00", title: "ì¥í•œê°€ ê³µì—°", chnName: "é•¿æ¨æ­Œ", lat: 34.365, lng: 109.213, desc: "í™”ì²­ì§€ ë‚´ ì‹¤ê²½ ì•¼ì™¸ ê³µì—° (ë°©í•œëŒ€ì±… í•„ìˆ˜)", icon: "fa-ticket", isHighlight: true }
                ]
            },
            {
                day: 6, date: "01.04 (ì¼)", city: "ì‹œì•ˆ", title: "ëŒ€ë‹¹ë¶ˆì•¼ì„±",
                items: [
                    { id: 601, time: "10:00", title: "ëŒ€ì•ˆíƒ‘", chnName: "å¤§é›å¡”", lat: 34.219, lng: 108.964, desc: "í˜„ì¥ë²•ì‚¬ì˜ ë¶ˆê²½ ë³´ê´€ íƒ‘", icon: "fa-gopuram" },
                    { id: 602, time: "13:00", title: "ì™•í™ ì²´í—˜ (ë³µì‹)", chnName: "å¤§å”ä¸å¤œåŸ (æ±‰æœä½“éªŒ)", lat: 34.213, lng: 108.962, desc: "ë‹¹ë‚˜ë¼ ì „í†µ ì˜ìƒ ëŒ€ì—¬ ë° ë©”ì´í¬ì—…", icon: "fa-shirt" },
                    { id: 603, time: "19:00", title: "ëŒ€ë‹¹ë¶ˆì•¼ì„± ì•¼ê²½", chnName: "å¤§å”ä¸å¤œåŸ", lat: 34.213, lng: 108.962, desc: "ì¤‘êµ­ ìµœê³ ì˜ ì•¼ê²½ ê±°ë¦¬ì™€ ê±°ë¦¬ ê³µì—°", icon: "fa-camera", isHighlight: true }
                ]
            },
            {
                day: 7, date: "01.05 (ì›”)", city: "ì‹œì•ˆ", title: "ì„±ë²½ íˆ¬ì–´ ë° ê·€êµ­",
                items: [
                    { id: 701, time: "09:00", title: "ì‹œì•ˆ ì„±ë²½ (ë‚¨ë¬¸)", chnName: "è¥¿å®‰åŸå¢™ (æ°¸å®é—¨)", lat: 34.251, lng: 108.948, desc: "ì„±ë²½ ìœ„ ìì „ê±° íƒ€ê¸°", icon: "fa-bicycle" },
                    { id: 702, time: "14:00", title: "ì‹œì•ˆ ê³µí•­ ì´ë™", chnName: "è¥¿å®‰å’¸é˜³å›½é™…æœºåœº", lat: 34.447, lng: 108.751, desc: "ì¶œêµ­ ìˆ˜ì† ë° ê·€êµ­", icon: "fa-plane-departure" }
                ]
            }
        ];

        // --- State Management ---
        let scheduleData = [];
        let currentDay = 0;
        let viewMode = 'list'; 
        let isEditMode = false;
        let favorites = [];
        let modalTarget = null;

        // --- Load & Save System ---
        function loadData() {
            const savedSchedule = localStorage.getItem('tripSchedule_v3');
            const savedFavorites = localStorage.getItem('tripFavorites_v3');
            const bannerClosed = localStorage.getItem('tripBannerClosed_v3');
            
            if (savedSchedule) {
                scheduleData = JSON.parse(savedSchedule);
            } else {
                scheduleData = JSON.parse(JSON.stringify(initialScheduleData));
            }

            if (savedFavorites) favorites = JSON.parse(savedFavorites);
            
            // Check PWA status
            const isPWA = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
            if (!isPWA && !bannerClosed) {
                document.getElementById('installBanner').classList.remove('hidden');
            }
        }

        function saveData() {
            localStorage.setItem('tripSchedule_v3', JSON.stringify(scheduleData));
            localStorage.setItem('tripFavorites_v3', JSON.stringify(favorites));
            const indicator = document.getElementById('saveStatus');
            indicator.classList.remove('hidden');
            setTimeout(() => indicator.classList.add('hidden'), 2000);
        }

        function confirmReset() {
            if (confirm('ëª¨ë“  ìˆ˜ì •ì‚¬í•­ì„ ì´ˆê¸°í™”í•˜ê³  ì²˜ìŒ ìƒíƒœë¡œ ë˜ëŒë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('tripSchedule_v3');
                location.reload();
            }
        }
        
        function closeBanner() {
            document.getElementById('installBanner').classList.add('hidden');
            localStorage.setItem('tripBannerClosed_v3', 'true');
        }

        // --- Render Logic ---
        function render() {
            const navContainer = document.getElementById('dateNav');
            const mainContainer = document.getElementById('schedule-container');
            const tabList = document.getElementById('tabList');
            const tabLikes = document.getElementById('tabLikes');
            
            document.getElementById('likeCount').innerText = favorites.length;

            if (viewMode === 'list') {
                tabList.className = "flex-1 py-3 text-sm font-medium text-center text-red-500 border-b-2 border-red-500 transition";
                tabLikes.className = "flex-1 py-3 text-sm font-medium text-center text-gray-400 hover:text-gray-600 transition";
                document.getElementById('dateNavWrapper').classList.remove('hidden');
                renderNav();
                renderList(mainContainer);
            } else {
                tabList.className = "flex-1 py-3 text-sm font-medium text-center text-gray-400 hover:text-gray-600 transition";
                tabLikes.className = "flex-1 py-3 text-sm font-medium text-center text-red-500 border-b-2 border-red-500 transition";
                document.getElementById('dateNavWrapper').classList.add('hidden');
                renderLikes(mainContainer);
            }

            const fab = document.getElementById('fabAdd');
            if (isEditMode && viewMode === 'list') fab.classList.remove('hidden');
            else fab.classList.add('hidden');
        }

        function renderNav() {
            const container = document.getElementById('dateNav');
            container.innerHTML = '';
            
            scheduleData.forEach((dayData, idx) => {
                const btn = document.createElement('button');
                const isActive = idx === currentDay;
                btn.className = `flex-none py-3 px-5 text-center transition-colors ${isActive ? 'active-tab' : 'inactive-tab'}`;
                btn.onclick = () => { currentDay = idx; render(); };
                btn.innerHTML = `
                    <div class="text-xs mb-0.5">${dayData.city}</div>
                    <div class="text-sm">${dayData.date.split(' ')[0]}</div>
                `;
                container.appendChild(btn);
                if (isActive) {
                    setTimeout(() => btn.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' }), 100);
                }
            });
        }

        function renderList(container) {
            const data = scheduleData[currentDay];
            let html = `
                <div class="animate-fade-in pb-16">
                    <div class="mb-6 mt-2">
                        <h2 class="text-2xl font-bold text-gray-800">${data.title}</h2>
                        <p class="text-sm text-gray-500 mt-1">${data.date} Â· ${data.items.length}ê°œì˜ ì¼ì •</p>
                    </div>
                    <div class="timeline-container"><div class="timeline-line"></div>
            `;

            if (data.items.length === 0) {
                html += `<div class="pl-12 py-8 text-gray-400 text-sm">ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤. + ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¶”ê°€í•˜ì„¸ìš”.</div>`;
            }

            data.items.forEach((item, index) => {
                const isLiked = favorites.includes(item.id);
                html += createCardHtml(item, index + 1, isLiked);
            });
            html += `</div></div>`;
            container.innerHTML = html;
        }

        function renderLikes(container) {
            const allItems = scheduleData.flatMap(d => d.items);
            const likedItems = allItems.filter(item => favorites.includes(item.id));

            if (likedItems.length === 0) {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-64 text-gray-400 animate-fade-in">
                        <i class="fa-regular fa-heart text-4xl mb-3"></i>
                        <p>ì €ì¥ëœ ì¥ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p class="text-xs mt-1">í•˜íŠ¸ ì•„ì´ì½˜ì„ ëˆŒëŸ¬ ì¼ì •ì„ ì €ì¥í•´ë³´ì„¸ìš”.</p>
                    </div>
                `;
                return;
            }

            let html = `<div class="mt-4 animate-fade-in"><h2 class="text-xl font-bold mb-4 px-1">ì €ì¥ëœ ì¥ì†Œ (${likedItems.length})</h2><div class="space-y-4">`;
            likedItems.forEach(item => {
                html += createCardHtml(item, null, true); 
            });
            html += `</div></div>`;
            container.innerHTML = html;
        }

        function createCardHtml(item, index, isLiked) {
            const editOverlay = isEditMode ? `
                <div class="absolute inset-0 bg-white/80 z-20 flex items-center justify-center gap-3 backdrop-blur-[1px] animate-fade-in border-2 border-blue-100 rounded-xl">
                    <button onclick="openEditModal(${item.id})" class="bg-blue-500 text-white px-4 py-2 rounded-lg shadow font-bold text-sm hover:bg-blue-600">ìˆ˜ì •</button>
                    <button onclick="deleteItem(${item.id})" class="bg-red-500 text-white px-4 py-2 rounded-lg shadow font-bold text-sm hover:bg-red-600">ì‚­ì œ</button>
                </div>
            ` : '';

            return `
                <div class="relative flex gap-4 mb-8 z-10 items-start group ${isEditMode ? 'edit-mode-shake' : ''}">
                    <div class="flex-shrink-0 w-14 flex flex-col items-center">
                        <div class="w-8 h-8 rounded-full ${item.isHighlight ? 'bg-red-500 text-white shadow-red-200' : 'bg-white border-2 border-gray-200 text-gray-500'} shadow-sm flex items-center justify-center text-sm font-bold z-10 mb-1">
                            ${index ? index : `<i class="fa-solid ${item.icon} text-xs"></i>`}
                        </div>
                        ${index ? `<span class="text-xs text-gray-400 font-mono">${item.time}</span>` : ''}
                    </div>
                    <div class="flex-1 bg-white rounded-xl p-4 shadow-sm border border-gray-100 btn-press relative overflow-hidden">
                        ${editOverlay}
                        <div class="flex justify-between items-start mb-1">
                            <h3 class="font-bold text-gray-800 text-lg leading-tight">${item.title}</h3>
                            ${!isEditMode ? `
                            <button onclick="toggleLike(${item.id})" class="w-8 h-8 flex items-center justify-center -mr-2 -mt-2 heart-anim">
                                <i class="${isLiked ? 'fa-solid text-red-500' : 'fa-regular text-gray-400'} fa-heart text-lg"></i>
                            </button>` : ''}
                        </div>
                        <p class="text-xs text-gray-500 font-medium mb-2">${item.chnName || 'ì¤‘êµ­ì–´ ì§€ëª… ì—†ìŒ'}</p>
                        <p class="text-sm text-gray-600 leading-relaxed mb-3 line-clamp-2">${item.desc}</p>
                        <div class="flex gap-2 mt-3 border-t border-gray-50 pt-3">
                            <button onclick="openMapModal('${item.title}', '${item.chnName || item.title}', ${item.lat || 0}, ${item.lng || 0})" 
                                class="flex-1 flex items-center justify-center gap-2 bg-blue-50 text-blue-600 py-2 rounded-lg text-sm font-medium hover:bg-blue-100 transition">
                                <i class="fa-solid fa-map-location-dot"></i>
                                ì§€ë„ ë³´ê¸°
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- Editing Logic ---
        function toggleEditMode() {
            isEditMode = !isEditMode;
            const btn = document.getElementById('btnEditMode');
            if (isEditMode) {
                btn.classList.add('bg-blue-500', 'text-white');
                btn.classList.remove('bg-gray-100', 'text-gray-600');
            } else {
                btn.classList.remove('bg-blue-500', 'text-white');
                btn.classList.add('bg-gray-100', 'text-gray-600');
            }
            render();
        }

        function openEditModal(itemId) {
            const modal = document.getElementById('editModal');
            const form = document.getElementById('editForm');
            const btnDelete = document.getElementById('btnDelete');

            if (itemId) {
                const dayData = scheduleData[currentDay];
                const item = dayData.items.find(i => i.id === itemId);
                if (!item) return;
                document.getElementById('editModalTitle').innerText = "ì¼ì • ìˆ˜ì •";
                document.getElementById('editItemId').value = item.id;
                document.getElementById('editTime').value = item.time;
                document.getElementById('editIcon').value = item.icon;
                document.getElementById('editTitle').value = item.title;
                document.getElementById('editChnName').value = item.chnName || '';
                document.getElementById('editDesc').value = item.desc;
                document.getElementById('editLat').value = item.lat || '';
                document.getElementById('editLng').value = item.lng || '';
                btnDelete.classList.remove('hidden');
            } else {
                document.getElementById('editModalTitle').innerText = "ìƒˆ ì¼ì • ì¶”ê°€";
                form.reset();
                document.getElementById('editItemId').value = '';
                document.getElementById('editTime').value = "12:00";
                btnDelete.classList.add('hidden');
            }
            modal.classList.remove('hidden');
        }

        function closeEditModal() { document.getElementById('editModal').classList.add('hidden'); }

        function saveItem(e) {
            e.preventDefault();
            const idVal = document.getElementById('editItemId').value;
            const time = document.getElementById('editTime').value;
            const icon = document.getElementById('editIcon').value;
            const title = document.getElementById('editTitle').value;
            const chnName = document.getElementById('editChnName').value;
            const desc = document.getElementById('editDesc').value;
            const lat = parseFloat(document.getElementById('editLat').value) || 34.26; 
            const lng = parseFloat(document.getElementById('editLng').value) || 108.94;

            if (idVal) {
                const id = parseInt(idVal);
                const dayData = scheduleData[currentDay];
                const idx = dayData.items.findIndex(i => i.id === id);
                if (idx > -1) dayData.items[idx] = { ...dayData.items[idx], time, icon, title, chnName, desc, lat, lng };
            } else {
                const newItem = { id: Date.now(), time, icon, title, chnName, desc, lat, lng, isHighlight: false };
                scheduleData[currentDay].items.push(newItem);
            }
            scheduleData[currentDay].items.sort((a, b) => a.time.localeCompare(b.time));
            saveData();
            closeEditModal();
            render();
        }

        function deleteCurrentItem() {
            const idVal = document.getElementById('editItemId').value;
            if (idVal) deleteItem(parseInt(idVal));
            closeEditModal();
        }

        function deleteItem(id) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                scheduleData[currentDay].items = scheduleData[currentDay].items.filter(i => i.id !== id);
                saveData();
                render();
            }
        }

        function toggleLike(id) {
            if (favorites.includes(id)) favorites = favorites.filter(fid => fid !== id);
            else favorites.push(id);
            saveData();
            render();
        }

        function openMapModal(title, chnName, lat, lng) {
            modalTarget = { title, chnName };
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalChnName').innerText = chnName;
            document.getElementById('btnGaode').href = `https://uri.amap.com/marker?position=${lng},${lat}&name=${encodeURIComponent(chnName)}`;
            document.getElementById('btnBaidu').href = `http://api.map.baidu.com/marker?location=${lat},${lng}&title=${encodeURIComponent(chnName)}&content=${encodeURIComponent(title)}&output=html`;
            document.getElementById('mapModal').classList.remove('hidden');
        }

        function closeMapModal() { document.getElementById('mapModal').classList.add('hidden'); }
        
        function copyChnName() {
            if(modalTarget && modalTarget.chnName) {
                navigator.clipboard.writeText(modalTarget.chnName).then(() => alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'));
            }
        }
        
        // Global Listeners
        document.getElementById('mapModal').addEventListener('click', (e) => { if (e.target.id === 'mapModal') closeMapModal(); });

        // Init
        loadData();
        render();

    </script>
    
    <style>
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .animate-slide-up { animation: slideUp 0.3s ease-out forwards; }
    </style>
</body>
</html>
